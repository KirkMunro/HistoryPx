## HistoryPx

### Overview

HistoryPx uses proxy commands to add extended history information to
PowerShell. This includes the duration of a command, a flag indicating whether
a command was successful or not, the output generated by a command (limited to
a configurable maximum value), the error generated by a command, and the
actual number of objects returned as output and as error records.  HistoryPx
also adds a "__" variable to PowerShell that contains the output from the last
command, even if the last command did not generate any output.  Lastly,
HistoryPx includes commands to manage the memory footprint that is used by
extended history information.

### Minimum requirements

- PowerShell 3.0
- SnippetPx module

### License and Copyright

Copyright 2014 Kirk Munro

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.

### Installing the HistoryPx module

HistoryPx is dependent on the SnippetPx module. You can download and install the
latest versions of HistoryPx and SnippetPx using any of the following methods:

#### PowerShellGet

If you don't know what PowerShellGet is, it's the way of the future for PowerShell
package management. If you're curious to find out more, you should read this:
<a href="http://blogs.msdn.com/b/mvpawardprogram/archive/2014/10/06/package-management-for-powershell-modules-with-powershellget.aspx" target="_blank">Package Management for PowerShell Modules with PowerShellGet</a>

Note that these commands require that you have the PowerShellGet module installed
on the system where they are invoked.

```powershell
# If you don’t have HistoryPx installed already and you want to install it for all
# all users (recommended, requires elevation)
Install-Module HistoryPx,SnippetPx

# If you don't have HistoryPx installed already and you want to install it for the
# current user only
Install-Module HistoryPx,SnippetPx -Scope CurrentUser

# If you have HistoryPx installed and you want to update it
Update-Module
```

#### PowerShell 3.0 or Later

To install from PowerShell 3.0 or later, open a native PowerShell console (not ISE,
unless you want it to take longer), and invoke one of the following commands:

```powershell
# If you want to install HistoryPx for all users or update a version already installed
# (recommended, requires elevation for new install for all users)
& ([scriptblock]::Create((iwr -uri http://tinyurl.com/Install-GitHubHostedModule).Content)) -ModuleName HistoryPx,SnippetPx

# If you want to install HistoryPx for the current user
& ([scriptblock]::Create((iwr -uri http://tinyurl.com/Install-GitHubHostedModule).Content)) -ModuleName HistoryPx,SnippetPx -Scope CurrentUser
```

### Loading the HistoryPx module

When it comes to module auto-loading, HistoryPx does not function the same way
that other modules do, because the proxy commands it includes are part of core
PowerShell modules that take priority during command lookup. As a result, you
should manually load HistoryPx in order to get extended history support in
PowerShell by invoking the following command:

```powershell
Import-Module HistoryPx
```

If you use HistoryPx on a regular basis, you can add that to your profile
script so that it is automatically loaded in every session.

### Using the HistoryPx module

The HistoryPx module is designed to work transparently within PowerShell. For
example, once the module is loaded and after you have invoked several commands,
you can display history information by invoking Get-History. With HistoryPx
loaded, this will show you output similar to the following:

  Id CommandLine       Duration         Success Output          ErrorCount
  -- -----------       --------         ------- ------          ----------
   1 ipmo HistoryPx    00:00:00.3120149 True
   2 Get-Service       00:00:00.2391177 True    {AdobeARMse...
   3 Get-Process       00:00:00.9584517 True    {System.Dia...
   4 function Test-... 00:00:00         True
   5 Test-Throw        00:00:00.0020005 False                            1

This output provides you with much richer historical information, including the
command duration, a flag indicating whether the command was successful or not
according to how PowerShell measures command success, the objects that were
output by the command, and the number of errors that were generated by the
command. This view is the default view for extended history information. You can
see even more details by passing the results of Get-History to Format-List, as
follows:

```powershell
Get-History | Format-List *
```

Being able to view extended history information can come at a cost though,
because it requires keeping output in memory. In order to manage that requirement
properly, the HistoryPx module includes commands to configure the maximum number
of extended history entries that will be retained in the current session as well
as the maximum number of output items that will be retained per extended history
entry. By default, HistoryPx will retain 200 extended history entries and 1000
output items per entry. To change those values, you can use the
Set-ExtendedHistoryConfiguration command, as follows:

```powershell
Set-ExtendedHistoryConfiguration -MaximumEntryCount 100 -MaximumItemCountPerEntry 500
```

Also, if there are specific entries in the history that you want to remove, you
can simply use Clear-History, which is a proxy cmdlet in HistoryPx. It will clear
the appropriate history entries as well as any extended history information that
is associated with those entries.

Aside from providing extended history information, HistoryPx also adds support
for the double-underscore ("__") variable to Windows PowerShell. The double-underscore
variable does not exist by default, however a number of PowerShell community
members have found it useful to have that variable store the results of the
previous command. Unfortunately, the recommended way to get this support in PowerShell
by using the PSDefaultParameterValues variable comes with a shortcoming, such that
the double-underscore variable will not be updated if you invoke a command that does
not return any output. HistoryPx includes an alternate implementation to provide
support for a double-underscore variable ("__") without shortcomings, such that it
always contains the output of the last command that was invoked.

That should give you a good idea of what is included in this module. If you have
ideas on what else you might like to see related to command history, please
let me know on the GitHub page.